import{r as e,j as a,z as t,B as n,H as s,J as l,K as i,M as o,D as r,N as c,O as d,v as h}from"./index1-BdYegYN6.js";import{T as m,g as p,a as x,S as u}from"./index2-HZ7cGdXE.js";const j=()=>{const{customSettings:j}=e.useContext(m),b=p(j,"background"),y=j?.backgroundColor1||"#1a1a1a",f=(e,a)=>{if(!e)return`rgba(255, 255, 255, ${a})`;return`rgba(${parseInt(e.slice(1,3),16)}, ${parseInt(e.slice(3,5),16)}, ${parseInt(e.slice(5,7),16)}, ${a})`},[g,C]=e.useState([]),[v,N]=e.useState(null),[k,w]=e.useState("/"),[$,S]=e.useState([]),[F,z]=e.useState(!1),[B,D]=e.useState(""),[R,E]=e.useState(null),[I,M]=e.useState(null),[P,T]=e.useState(""),[U,_]=e.useState(!1),[L,K]=e.useState(""),[A,O]=e.useState(""),[G,H]=e.useState(null),[J,W]=e.useState(!1),[Z,q]=e.useState(!1),[Q,V]=e.useState(!1),[X,Y]=e.useState(""),[ee,ae]=e.useState([]),te=$.length>0&&ee.length===$.length,[ne,se]=e.useState(["/"]),[le,ie]=e.useState(0);e.useEffect(()=>{if(k!==ne[le]){const e=ne.slice(0,le+1);e.push(k),se(e),ie(e.length-1)}},[k]);e.useEffect(()=>{oe()},[]);const oe=async()=>{try{const e=await x.get("/api/alterion/panel/server/available-servers",{withCredentials:!0});C(e.data.servers||[]),e.data.servers&&e.data.servers.length>0&&N(e.data.servers[0])}catch(e){D("Failed to fetch servers")}};e.useEffect(()=>{v&&re()},[v,k]);const re=async()=>{if(v){z(!0),D("");try{const e=await x.get(`/api/alterion/panel/files/${v.id}/list/`,{params:{path:k},withCredentials:!0});S(e.data.files||[])}catch(e){D(e.response?.data?.error||"Failed to fetch files"),S([])}finally{z(!1)}}},ce=e=>{if("directory"===e.type){const a="/"===k?`/${e.name}`:`${k}/${e.name}`;w(a),E(null)}else he(e)},de=async e=>{if(v&&e)try{const a="/"===k?`/${e.name}`:`${k}/${e.name}`,t=await x.get(`/api/alterion/panel/files/${v.id}/download/`,{params:{path:a},responseType:"blob",withCredentials:!0}),n=window.URL.createObjectURL(new Blob([t.data])),s=document.createElement("a");s.href=n,s.setAttribute("download",e.name),document.body.appendChild(s),s.click(),s.remove()}catch(a){D(a.response?.data?.error||"Failed to download file")}},he=async e=>{if(v&&e){z(!0),D("");try{const a="/"===k?`/${e.name}`:`${k}/${e.name}`,t=await x.get(`/api/alterion/panel/files/${v.id}/read_file/`,{params:{path:a},withCredentials:!0});O(t.data.content||""),H(e)}catch(a){D(a.response?.data?.error||"Failed to read file")}finally{z(!1)}}},me=e=>{if(!e||0===e)return"0 B";const a=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,a)).toFixed(2))+" "+["B","KB","MB","GB"][a]};return a.jsxs("div",{className:"file-manager",style:{color:b},children:[a.jsx("div",{className:"server-selector",style:{color:b},children:a.jsx(u,{selectedNode:v,onNodeChange:e=>{N(e),w("/")}})}),a.jsxs("div",{className:"actions-bar",style:{margin:"1.2rem 0"},children:[a.jsx("div",{className:"search-filter",style:{flex:1},children:a.jsxs("div",{className:"search-box",style:{minWidth:200,flex:1,border:"1px solid rgba(255,255,255,0.1)",borderRadius:10,padding:"10px 16px",display:"flex",alignItems:"center",background:"transparent"},children:[a.jsx("button",{className:"btn-icon",style:{background:"none",border:"none",boxShadow:"none",marginRight:4,padding:0,display:"flex",alignItems:"center"},onClick:()=>{le>0&&(ie(le-1),w(ne[le-1]))},disabled:0===le,title:"Back",type:"button",children:a.jsx(t,{size:18,color:b})}),a.jsx("button",{className:"btn-icon",style:{background:"none",border:"none",boxShadow:"none",marginRight:8,padding:0,display:"flex",alignItems:"center"},onClick:()=>{le<ne.length-1&&(ie(le+1),w(ne[le+1]))},disabled:le===ne.length-1,title:"Forward",type:"button",children:a.jsx(n,{size:18,color:b})}),a.jsx(s,{size:18,style:{marginRight:8,opacity:.6,color:b}}),a.jsx("input",{type:"text",value:k,onChange:e=>w(e.target.value),onBlur:()=>re(),onKeyDown:e=>{"Enter"===e.key&&re()},style:{background:"transparent",border:"none",color:b,fontFamily:"monospace",fontSize:"1.08rem",outline:"none",width:"100%"},placeholder:"/path/to/folder"})]})}),a.jsxs("div",{className:"action-buttons",children:[a.jsxs("button",{className:"btn btn-secondary",onClick:()=>W(!0),children:[a.jsx(l,{size:18})," Upload"]}),a.jsxs("button",{className:"btn btn-secondary",onClick:()=>q(!0),children:[a.jsx(i,{size:18})," New File"]}),a.jsxs("button",{className:"btn btn-secondary",onClick:()=>V(!0),children:[a.jsx(o,{size:18})," New Folder"]})]})]}),B&&a.jsx("div",{className:"error-message",children:B}),v&&a.jsxs("div",{className:"file-manager-content",children:[J&&a.jsx("div",{className:"modal-overlay",onClick:()=>W(!1),children:a.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[a.jsx("h3",{children:"Upload File"}),a.jsx("input",{type:"file",onChange:e=>M(e.target.files[0])}),a.jsxs("div",{className:"modal-actions",children:[a.jsx("button",{onClick:async()=>{if(v&&I){z(!0),D("");try{const e=new FormData;e.append("file",I),e.append("path",k),await x.post(`/api/alterion/panel/files/${v.id}/upload/`,e,{headers:{"Content-Type":"multipart/form-data"},withCredentials:!0}),M(null),re()}catch(e){D(e.response?.data?.error||"Failed to upload file")}finally{z(!1)}}},disabled:!I||F,children:"Upload"}),a.jsx("button",{onClick:()=>W(!1),children:"Cancel"})]})]})}),Z&&a.jsx("div",{className:"modal-overlay",onClick:()=>q(!1),children:a.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[a.jsx("h3",{children:"Create New File"}),a.jsx("input",{type:"text",placeholder:"File name",value:X,onChange:e=>Y(e.target.value)}),a.jsxs("div",{className:"modal-actions",children:[a.jsx("button",{onClick:()=>{q(!1),Y("")},disabled:!X.trim()||F,children:"Create"}),a.jsx("button",{onClick:()=>q(!1),children:"Cancel"})]})]})}),Q&&a.jsx("div",{className:"modal-overlay",onClick:()=>V(!1),children:a.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[a.jsx("h3",{children:"Create New Folder"}),a.jsx("input",{type:"text",placeholder:"Folder name",value:P,onChange:e=>T(e.target.value)}),a.jsxs("div",{className:"modal-actions",children:[a.jsx("button",{onClick:async()=>{if(v&&P.trim()){z(!0),D("");try{const e="/"===k?`/${P}`:`${k}/${P}`;await x.post(`/api/alterion/panel/files/${v.id}/create_directory/`,{path:e},{withCredentials:!0}),T(""),re()}catch(e){D(e.response?.data?.error||"Failed to create folder")}finally{z(!1)}}},disabled:!P.trim()||F,children:"Create"}),a.jsx("button",{onClick:()=>V(!1),children:"Cancel"})]})]})}),F?a.jsx("div",{className:"loading",children:"Loading..."}):a.jsxs("div",{className:"domains-table-container",style:{color:b,background:`linear-gradient(135deg, ${y}10, ${y}05)`,borderColor:f(b,.5)},children:[a.jsxs("table",{className:"domains-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:a.jsx("input",{type:"checkbox",checked:te,onChange:()=>{ae(te?[]:$.map(e=>e.name))}})}),a.jsx("th",{children:"Name"}),a.jsx("th",{children:"Type"}),a.jsx("th",{children:"Size"}),a.jsx("th",{children:"Modified"}),a.jsx("th",{children:"Permissions"}),a.jsx("th",{children:"Actions"})]})}),a.jsx("tbody",{children:$.map((e,t)=>{return a.jsxs("tr",{className:R?.name===e.name?"selected":"",onClick:()=>E(e),style:{borderTopColor:f(b,.5)},children:[a.jsx("td",{children:a.jsx("input",{type:"checkbox",checked:ee.includes(e.name),onChange:a=>{return t=e.name,n=a.target.checked,void ae(e=>n?[...e,t]:e.filter(e=>e!==t));var t,n}})}),a.jsxs("td",{className:"file-name domain-cell",onDoubleClick:()=>ce(e),children:[a.jsx("span",{className:`file-icon ${e.type}`,children:"directory"===e.type?a.jsx(s,{size:16}):a.jsx(i,{size:16})}),e.name]}),a.jsx("td",{children:e.type}),a.jsx("td",{children:"file"===e.type?me(e.size):"-"}),a.jsx("td",{children:(n=e.modified,n?new Date(n).toLocaleString():"-")}),a.jsx("td",{children:e.permissions||"-"}),a.jsxs("td",{className:"actions action-buttons-cell",children:["file"===e.type&&a.jsxs(a.Fragment,{children:[a.jsx("button",{className:"btn-icon",title:"Download",onClick:()=>de(e),children:a.jsx(r,{size:16})}),a.jsx("button",{className:"btn-icon",title:"Edit",onClick:()=>he(e),children:a.jsx(c,{size:16})})]}),"directory"===e.type&&a.jsx("button",{className:"btn-icon",title:"Download ZIP",onClick:()=>de(e),children:a.jsx(r,{size:16})}),a.jsx("button",{className:"btn-icon",title:"Rename",onClick:()=>{E(e),K(e.name),_(!0)},children:a.jsx(d,{size:16})}),a.jsx("button",{className:"btn-icon btn-danger",title:"Delete",onClick:()=>(async e=>{if(v&&e&&confirm(`Delete ${e.name}?`)){z(!0),D("");try{const a="/"===k?`/${e.name}`:`${k}/${e.name}`;await x.delete(`/api/alterion/panel/files/${v.id}/delete/`,{params:{path:a},withCredentials:!0}),E(null),re()}catch(a){D(a.response?.data?.error||"Failed to delete")}finally{z(!1)}}})(e),children:a.jsx(h,{size:16})})]})]},t);var n})})]}),0===$.length&&!F&&a.jsx("div",{className:"empty-state",children:"No files in this directory"})]})]}),U&&a.jsx("div",{className:"modal-overlay",onClick:()=>_(!1),children:a.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[a.jsxs("h3",{children:["Rename ",R?.name]}),a.jsx("input",{type:"text",value:L,onChange:e=>K(e.target.value),placeholder:"New name"}),a.jsxs("div",{className:"modal-actions",children:[a.jsx("button",{onClick:async()=>{if(v&&R&&L.trim()){z(!0),D("");try{const e="/"===k?`/${R.name}`:`${k}/${R.name}`,a="/"===k?`/${L}`:`${k}/${L}`;await x.post(`/api/alterion/panel/files/${v.id}/rename/`,{old_path:e,new_path:a},{withCredentials:!0}),_(!1),K(""),E(null),re()}catch(e){D(e.response?.data?.error||"Failed to rename")}finally{z(!1)}}},disabled:!L.trim(),children:"Rename"}),a.jsx("button",{onClick:()=>_(!1),children:"Cancel"})]})]})}),G&&a.jsx("div",{className:"modal-overlay",onClick:()=>H(null),children:a.jsxs("div",{className:"modal-content editor-modal",onClick:e=>e.stopPropagation(),children:[a.jsxs("h3",{children:["Editing: ",G.name]}),a.jsx("textarea",{value:A,onChange:e=>O(e.target.value),rows:20}),a.jsxs("div",{className:"modal-actions",children:[a.jsx("button",{onClick:async()=>{if(v&&G){z(!0),D("");try{const e="/"===k?`/${G.name}`:`${k}/${G.name}`;await x.post(`/api/alterion/panel/files/${v.id}/write_file/`,{path:e,content:A},{withCredentials:!0}),H(null),O(""),re()}catch(e){D(e.response?.data?.error||"Failed to save file")}finally{z(!1)}}},children:"Save"}),a.jsx("button",{onClick:()=>H(null),children:"Cancel"})]})]})})]})};export{j as F};
