import{r as e,j as t,H as a,J as n,K as s,M as i,N as l,O as r,Q as o,D as d,V as c,W as h,v as m}from"./index1-CrHaxmOc.js";import{T as p,u as x,g as u,a as g,S as f}from"./index2-DrFlYDh3.js";const j=()=>{const{customSettings:j}=e.useContext(p),{handleServerContextMenu:y}=x(),b=u(j,"background"),w=j?.backgroundColor1||"#1a1a1a",v=(e,t)=>{if(!e)return`rgba(255, 255, 255, ${t})`;return`rgba(${parseInt(e.slice(1,3),16)}, ${parseInt(e.slice(3,5),16)}, ${parseInt(e.slice(5,7),16)}, ${t})`},[C,k]=e.useState(null),N=(()=>{let e="",t="";return"alterionUser"in window&&"string"==typeof window.alterionUser&&(e=window.alterionUser),"alterionPlatform"in window&&"string"==typeof window.alterionPlatform?t=window.alterionPlatform:window.navigator&&"string"==typeof window.navigator.platform&&(t=window.navigator.platform),t.toLowerCase().includes("win")||t.toLowerCase().includes("mac")?e?`/Users/${e}`:"/Users":e?`/home/${e}`:"/home"})(),[$,S]=e.useState(N),[F,z]=e.useState([]),[D,T]=e.useState(!1),[B,R]=e.useState(""),[P,U]=e.useState(null),[_,E]=e.useState(null),[I,M]=e.useState(""),[L,W]=e.useState(!1),[A,O]=e.useState(""),[K,G]=e.useState(""),[H,J]=e.useState(null),[Q,V]=e.useState(!1),[Z,q]=e.useState(!1),[X,Y]=e.useState(!1),[ee,te]=e.useState(""),[ae,ne]=e.useState([]),se=F.length>0&&ae.length===F.length,[ie,le]=e.useState(!1),[re,oe]=e.useState(null),[de,ce]=e.useState(""),[he,me]=e.useState(!1),[pe,xe]=e.useState(0),[ue,ge]=e.useState(""),[fe,je]=e.useState([N]),[ye,be]=e.useState(0);e.useEffect(()=>{if($!==fe[ye]){const e=fe.slice(0,ye+1);e.push($),je(e),be(e.length-1)}},[$]);e.useEffect(()=>{we()},[]);const we=async()=>{try{const e=await g.get("/api/alterion/panel/server/available-servers",{withCredentials:!0});e.data.servers&&e.data.servers.length>0&&k(e.data.servers[0])}catch(e){R("Failed to fetch servers")}};e.useEffect(()=>{C&&g.get(`/api/alterion/panel/files/${C.id}/list/`,{params:{path:"/",use_home:"true"},withCredentials:!0}).then(e=>{e.data.home_directory?(S(e.data.home_directory),je([e.data.home_directory]),be(0)):(S("/"),je(["/"]),be(0))})},[C]),e.useEffect(()=>{C&&$&&ve()},[$]);const ve=async()=>{if(C){T(!0),R("");try{const e=await g.get(`/api/alterion/panel/files/${C.id}/list/`,{params:{path:$},withCredentials:!0});z(e.data.files||[])}catch(e){R(e?.response?.data?.error||"Failed to fetch files"),z([])}finally{T(!1)}}},Ce=e=>{if("directory"===e.type){const t="/"===$?`/${e.name}`:`${$}/${e.name}`;S(t),U(null)}else $e(e)},ke=async e=>{if(C&&e)try{me(!0),xe(0),ge("preparing");const t="/"===$?`/${e.name}`:`${$}/${e.name}`,a=(await g.post(`/api/alterion/panel/files/${C.id}/prepare-download/`,{path:t},{withCredentials:!0})).data.task_id,n=async()=>{const e=await g.get(`/api/alterion/panel/files/${C.id}/download-progress/`,{params:{task_id:a},withCredentials:!0}),{status:t,progress:n,message:s}=e.data;if(xe(n),ge("ready"===t?"downloading":"preparing"),"ready"===t)return!0;if("error"===t)throw new Error(s||"Failed to prepare download");return!1};for(;;){if(await n())break;await new Promise(e=>setTimeout(e,500))}ge("downloading");const s=await g.get(`/api/alterion/panel/files/${C.id}/download/`,{params:{task_id:a},responseType:"blob",withCredentials:!0,onDownloadProgress:e=>{if(e.total){const t=Math.round(100*e.loaded/e.total);xe(t)}}});ge("complete"),xe(100);let i=e.name;const l=s.headers["content-disposition"];if(l){const e=l.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);e&&e[1]&&(i=e[1].replace(/['"]/g,""))}const r=window.URL.createObjectURL(new Blob([s.data])),o=document.createElement("a");o.href=r,o.setAttribute("download",i),document.body.appendChild(o),o.click(),o.remove(),window.URL.revokeObjectURL(r),setTimeout(()=>{me(!1),xe(0),ge("")},1e3)}catch(t){me(!1),R(t?.response?.data?.error||t?.message||"Failed to download file")}},Ne=async()=>{if(!C||!re)return;T(!0),R("");const e="/"===$?`/${re.name}`:`${$}/${re.name}`;try{await g.delete(`/api/alterion/panel/files/${C.id}/delete/`,{params:{path:e},withCredentials:!0}),U(null),le(!1),oe(null),ce(""),ve()}catch(t){R(t?.response?.data?.error||"Failed to delete")}finally{T(!1)}},$e=async e=>{if(C&&e){T(!0),R("");try{const t="/"===$?`/${e.name}`:`${$}/${e.name}`,a=await g.get(`/api/alterion/panel/files/${C.id}/read_file/`,{params:{path:t},withCredentials:!0});G(a.data.content||""),J(e)}catch(t){R(t?.response?.data?.error||"Failed to read file")}finally{T(!1)}}},Se=e=>{if(!e||0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB"][t]};return t.jsxs("div",{className:"file-manager",style:{color:b},children:[t.jsx("div",{className:"server-selector",style:{color:b},children:t.jsx(f,{selectedNode:C,onNodeChange:e=>{k(e),S("/")},onServerContextMenu:(e,t)=>y(e,t,{onEdit:e=>{},onDelete:async e=>{if(confirm(`Are you sure you want to delete server "${e.name}"?`))try{await g.delete(`/api/alterion/panel/nodes/${e.id}/`,{withCredentials:!0}),C?.id===e.id&&k(null)}catch(t){}}})})}),t.jsxs("div",{className:"actions-bar",style:{margin:"1.2rem 0"},children:[t.jsx("div",{className:"search-filter",style:{flex:1},children:t.jsxs("div",{className:"search-box",style:{minWidth:200,flex:1,border:"1px solid rgba(255,255,255,0.1)",borderRadius:10,padding:"10px 16px",display:"flex",alignItems:"center",background:"transparent"},children:[t.jsx("button",{className:"btn-icon",style:{background:"none",border:"none",boxShadow:"none",marginRight:4,padding:0,display:"flex",alignItems:"center"},onClick:()=>{ye>0&&(be(ye-1),S(fe[ye-1]))},disabled:0===ye,title:"Back",type:"button",children:t.jsx(a,{size:18,color:b})}),t.jsx("button",{className:"btn-icon",style:{background:"none",border:"none",boxShadow:"none",marginRight:8,padding:0,display:"flex",alignItems:"center"},onClick:()=>{ye<fe.length-1&&(be(ye+1),S(fe[ye+1]))},disabled:ye===fe.length-1,title:"Forward",type:"button",children:t.jsx(n,{size:18,color:b})}),t.jsx("button",{className:"btn-icon",style:{background:"none",border:"none",boxShadow:"none",marginRight:8,padding:0,display:"flex",alignItems:"center"},onClick:()=>{if(!$||"/"===$)return;let e=$.replace(/\\/g,"/");e.length>1&&e.endsWith("/")&&(e=e.slice(0,-1)),e=e.replace(/^C:\//,"/").replace(/^C:/,"");const t=e.split("/").filter(Boolean);0===t.length?e="/":(e="/"+t.slice(0,-1).join("/"),""===e&&(e="/")),S(e)},disabled:"/"===$,title:"Up One Folder",type:"button",children:t.jsx(s,{size:18,color:b})}),t.jsx(i,{size:18,style:{marginRight:8,opacity:.6,color:b}}),t.jsx("input",{type:"text",value:(Fe=$,Fe&&Fe.startsWith("C:")?Fe.replace(/^C:/,""):Fe),onChange:e=>S(e.target.value),onBlur:()=>ve(),onKeyDown:e=>{"Enter"===e.key&&ve()},style:{background:"transparent",border:"none",color:b,fontFamily:"monospace",fontSize:"1.08rem",outline:"none",width:"100%"},placeholder:"/path/to/folder"})]})}),t.jsxs("div",{className:"action-buttons",children:[t.jsxs("button",{className:"btn btn-secondary",onClick:()=>V(!0),children:[t.jsx(l,{size:18})," Upload"]}),t.jsxs("button",{className:"btn btn-secondary",onClick:()=>q(!0),children:[t.jsx(r,{size:18})," New File"]}),t.jsxs("button",{className:"btn btn-secondary",onClick:()=>Y(!0),children:[t.jsx(o,{size:18})," New Folder"]})]})]}),B&&t.jsx("div",{className:"error-message",children:B}),C&&t.jsxs("div",{className:"file-manager-content",children:[Q&&t.jsx("div",{className:"modal-overlay",onClick:()=>V(!1),children:t.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[t.jsx("h3",{children:"Upload File"}),t.jsxs("div",{className:"upload-drop-area",style:{border:"2px dashed #888",borderRadius:"10px",padding:"18px 32px",background:"#222",color:"#eee",cursor:"pointer",minWidth:"180px",textAlign:"center",marginBottom:"1rem",transition:"border-color 0.2s"},onClick:()=>{const e=document.getElementById("modal-file-upload-input");e&&e.click()},onDragOver:e=>{e.preventDefault(),e.currentTarget.style.borderColor="#4f8cff"},onDragLeave:e=>{e.preventDefault(),e.currentTarget&&(e.currentTarget.style.borderColor="#888")},onDrop:e=>{e.preventDefault(),e.currentTarget.style.borderColor="#888",e.dataTransfer.files&&e.dataTransfer.files.length>0&&E(e.dataTransfer.files[0])},children:[t.jsx(l,{size:24,style:{marginBottom:8,opacity:.8}}),t.jsx("div",{style:{fontWeight:600,fontSize:"15px"},children:"Drag & Drop or Click to Select File"}),t.jsx("input",{id:"modal-file-upload-input",type:"file",style:{display:"none"},onChange:e=>{e.target.files&&e.target.files.length>0&&E(e.target.files[0])}}),_&&t.jsxs("div",{style:{marginTop:"10px",fontSize:"13px",color:"#4f8cff"},children:["Selected: ",_.name]})]}),t.jsxs("div",{className:"modal-actions",children:[t.jsx("button",{onClick:async()=>{if(C&&_){T(!0),R("");try{const e=new FormData;e.append("file",_),e.append("path",$),await g.post(`/api/alterion/panel/files/${C.id}/upload/`,e,{headers:{"Content-Type":"multipart/form-data"},withCredentials:!0}),E(null),ve()}catch(e){R(e?.response?.data?.error||"Failed to upload file")}finally{T(!1)}}},disabled:!_||D,children:"Upload"}),t.jsx("button",{onClick:()=>V(!1),children:"Cancel"})]})]})}),Z&&t.jsx("div",{className:"modal-overlay",onClick:()=>q(!1),children:t.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[t.jsx("h3",{children:"Create New File"}),t.jsx("input",{type:"text",placeholder:"File name",value:ee,onChange:e=>te(e.target.value)}),t.jsxs("div",{className:"modal-actions",children:[t.jsx("button",{onClick:()=>{if(!C||!ee.trim())return;T(!0),R("");const e="/"===$?`/${ee}`:`${$}/${ee}`;g.post(`/api/alterion/panel/files/${C.id}/write_file/`,{path:e,content:""},{withCredentials:!0}).then(()=>{q(!1),te(""),ve()}).catch(e=>{R(e.response?.data?.error||"Failed to create file")}).finally(()=>{T(!1)})},disabled:!ee.trim()||D,children:"Create"}),t.jsx("button",{onClick:()=>q(!1),children:"Cancel"})]})]})}),X&&t.jsx("div",{className:"modal-overlay",onClick:()=>Y(!1),children:t.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[t.jsx("h3",{children:"Create New Folder"}),t.jsx("input",{type:"text",placeholder:"Folder name",value:I,onChange:e=>M(e.target.value)}),t.jsxs("div",{className:"modal-actions",children:[t.jsx("button",{onClick:async()=>{if(C&&I.trim()){T(!0),R("");try{const e="/"===$?`/${I}`:`${$}/${I}`;await g.post(`/api/alterion/panel/files/${C.id}/create_directory/`,{path:e},{withCredentials:!0}),M(""),ve()}catch(e){R(e?.response?.data?.error||"Failed to create folder")}finally{T(!1)}}},disabled:!I.trim()||D,children:"Create"}),t.jsx("button",{onClick:()=>Y(!1),children:"Cancel"})]})]})}),D?t.jsx("div",{className:"loading",children:"Loading..."}):t.jsxs("div",{className:"domains-table-container",style:{color:b,background:`linear-gradient(135deg, ${w}10, ${w}05)`,borderColor:v(b,.5)},children:[t.jsxs("table",{className:"domains-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:t.jsx("input",{type:"checkbox",checked:se,onChange:()=>{ne(se?[]:F.map(e=>e.name))}})}),t.jsx("th",{children:"Name"}),t.jsx("th",{children:"Type"}),t.jsx("th",{children:"Size"}),t.jsx("th",{children:"Modified"}),t.jsx("th",{children:"Permissions"}),t.jsx("th",{children:"Actions"})]})}),t.jsx("tbody",{children:F.map((e,a)=>{return t.jsxs("tr",{className:P?.name===e.name?"selected":"",onClick:()=>U(e),style:{borderTopColor:v(b,.5)},children:[t.jsx("td",{children:t.jsx("input",{type:"checkbox",checked:ae.includes(e.name),onChange:t=>{return a=e.name,n=t.target.checked,void ne(e=>n?[...e,a]:e.filter(e=>e!==a));var a,n}})}),t.jsxs("td",{className:"file-name domain-cell",onDoubleClick:()=>Ce(e),children:[t.jsx("span",{className:`file-icon ${e.type}`,children:"directory"===e.type?t.jsx(i,{size:16}):t.jsx(r,{size:16})}),e.name]}),t.jsx("td",{children:e.type}),t.jsx("td",{children:"file"===e.type?Se(e.size):"-"}),t.jsx("td",{children:(n=e.modified,n?new Date(n).toLocaleString():"-")}),t.jsx("td",{children:e.permissions||"-"}),t.jsxs("td",{className:"actions action-buttons-cell",children:["file"===e.type&&t.jsxs(t.Fragment,{children:[t.jsx("button",{className:"btn-icon",title:"Download",onClick:()=>ke(e),children:t.jsx(d,{size:16})}),t.jsx("button",{className:"btn-icon",title:"Edit",onClick:()=>$e(e),children:t.jsx(c,{size:16})})]}),"directory"===e.type&&t.jsx("button",{className:"btn-icon",title:"Download ZIP",onClick:()=>ke(e),children:t.jsx(d,{size:16})}),t.jsx("button",{className:"btn-icon",title:"Rename",onClick:()=>{U(e),O(e.name),W(!0)},children:t.jsx(h,{size:16})}),t.jsx("button",{className:"btn-icon btn-danger",title:"Delete",onClick:()=>(e=>{C&&e&&(oe(e),le(!0),ce(""))})(e),children:t.jsx(m,{size:16})}),he&&t.jsx("div",{className:"modal-overlay",children:t.jsxs("div",{className:"modal-content",style:{maxWidth:400},children:[t.jsx("div",{className:"modal-header",children:t.jsxs("h2",{style:{display:"flex",alignItems:"center",gap:8},children:[t.jsx(d,{size:22,style:{color:"#10b981"}}),"preparing"===ue?"Preparing Download":"downloading"===ue?"Downloading":"Complete"]})}),t.jsxs("div",{style:{marginBottom:20},children:["preparing"===ue&&t.jsx("div",{style:{textAlign:"center",marginBottom:16},children:t.jsx("div",{style:{fontSize:14,color:"var(--text-secondary)",marginBottom:12},children:"Creating archive..."})}),t.jsx("div",{style:{width:"100%",height:8,background:"rgba(255, 255, 255, 0.1)",borderRadius:4,overflow:"hidden"},children:t.jsx("div",{style:{width:`${pe}%`,height:"100%",background:"complete"===ue?"#10b981":"#ffffff",transition:"width 0.3s ease",borderRadius:4}})}),t.jsxs("div",{style:{textAlign:"center",marginTop:8,fontSize:14,fontWeight:500},children:[pe,"%"]})]})]})}),ie&&re&&t.jsx("div",{className:"modal-overlay",onClick:()=>le(!1),children:t.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[t.jsx("div",{className:"modal-header",children:t.jsxs("h2",{style:{display:"flex",alignItems:"center",gap:8},children:[t.jsx(m,{size:22,style:{color:"#ef4444"}}),"Delete File"]})}),t.jsxs("div",{style:{marginBottom:16},children:["Are you sure you want to delete ",t.jsx("strong",{children:re.name}),"? This action cannot be undone.",t.jsx("br",{}),"Type ",t.jsx("strong",{children:re.name})," to confirm."]}),t.jsx("input",{type:"text",value:de,onChange:e=>ce(e.target.value),placeholder:`Type '${re.name}' to confirm`,style:{width:"100%",marginBottom:16}}),t.jsxs("div",{className:"modal-actions",children:[t.jsx("button",{className:"btn btn-danger",onClick:Ne,disabled:de!==re.name||D,children:"Delete"}),t.jsx("button",{className:"btn",onClick:()=>le(!1),children:"Cancel"})]})]})})]})]},a);var n})})]}),0===F.length&&!D&&t.jsx("div",{className:"empty-state",children:"No files in this directory"})]})]}),L&&t.jsx("div",{className:"modal-overlay",onClick:()=>W(!1),children:t.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[t.jsxs("h3",{children:["Rename ",P?.name]}),t.jsx("input",{type:"text",value:A,onChange:e=>O(e.target.value),placeholder:"New name"}),t.jsxs("div",{className:"modal-actions",children:[t.jsx("button",{onClick:async()=>{if(C&&P&&A.trim()){T(!0),R("");try{const e="/"===$?`/${P.name}`:`${$}/${P.name}`,t="/"===$?`/${A}`:`${$}/${A}`;await g.post(`/api/alterion/panel/files/${C.id}/rename/`,{old_path:e,new_path:t},{withCredentials:!0}),W(!1),O(""),U(null),ve()}catch(e){R(e?.response?.data?.error||"Failed to rename")}finally{T(!1)}}},disabled:!A.trim(),children:"Rename"}),t.jsx("button",{onClick:()=>W(!1),children:"Cancel"})]})]})}),H&&t.jsx("div",{className:"modal-overlay",onClick:()=>J(null),children:t.jsxs("div",{className:"modal-content editor-modal",onClick:e=>e.stopPropagation(),children:[t.jsxs("h3",{children:["Editing: ",H.name]}),t.jsx("textarea",{value:K,onChange:e=>G(e.target.value),rows:20}),t.jsxs("div",{className:"modal-actions",children:[t.jsx("button",{onClick:async()=>{if(C&&H){T(!0),R("");try{const e="/"===$?`/${H.name}`:`${$}/${H.name}`;await g.post(`/api/alterion/panel/files/${C.id}/write_file/`,{path:e,content:K},{withCredentials:!0}),J(null),G(""),ve()}catch(e){R(e?.response?.data?.error||"Failed to save file")}finally{T(!1)}}},children:"Save"}),t.jsx("button",{onClick:()=>J(null),children:"Cancel"})]})]})})]});var Fe};export{j as F};
