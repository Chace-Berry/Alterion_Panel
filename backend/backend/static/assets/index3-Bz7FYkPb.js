import{r as e,j as t,H as a,J as n,K as s,M as l,N as i,O as r,Q as o,D as d,V as c,W as h,w as m}from"./index1-pM3wkJQT.js";import{T as p,u as x,g as u,a as g,S as f}from"./index2-DsC3p7Du.js";var j={};const y=()=>{const[y,b]=e.useState(""),[v,C]=e.useState(null),{customSettings:w}=e.useContext(p),{handleServerContextMenu:k}=x(),N=u(w,"background"),$=w?.backgroundColor1||"#1a1a1a",S=(e,t)=>{if(!e)return`rgba(255, 255, 255, ${t})`;return`rgba(${parseInt(e.slice(1,3),16)}, ${parseInt(e.slice(3,5),16)}, ${parseInt(e.slice(5,7),16)}, ${t})`},[F,z]=e.useState([]),[D,R]=e.useState(null),B=(()=>{const e=window?.alterionUser||window?.USER||j?.USER||j?.USERNAME||"",t=window?.alterionPlatform||window?.navigator?.platform||"";return t.toLowerCase().includes("win")||t.toLowerCase().includes("mac")?e?`/Users/${e}`:"/Users":e?`/home/${e}`:"/home"})(),[T,E]=e.useState(B),[U,_]=e.useState([]),[P,I]=e.useState(!1),[M,L]=e.useState(""),[A,W]=e.useState(null),[O,K]=e.useState(null),[G,H]=e.useState(""),[J,Q]=e.useState(!1),[V,Z]=e.useState(""),[q,X]=e.useState(""),[Y,ee]=e.useState(null),[te,ae]=e.useState(!1),[ne,se]=e.useState(!1),[le,ie]=e.useState(!1),[re,oe]=e.useState(""),[de,ce]=e.useState([]),he=U.length>0&&de.length===U.length,[me,pe]=e.useState(!1),[xe,ue]=e.useState(null),[ge,fe]=e.useState(""),[je,ye]=e.useState(!1),[be,ve]=e.useState(0),[Ce,we]=e.useState(""),[ke,Ne]=e.useState([B]),[$e,Se]=e.useState(0);e.useEffect(()=>{if(T!==ke[$e]){const e=ke.slice(0,$e+1);e.push(T),Ne(e),Se(e.length-1)}},[T]);e.useEffect(()=>{Fe()},[]);const Fe=async()=>{try{const e=await g.get("/api/alterion/panel/server/available-servers",{withCredentials:!0});z(e.data.servers||[]),e.data.servers&&e.data.servers.length>0&&R(e.data.servers[0])}catch(e){L("Failed to fetch servers")}};e.useEffect(()=>{D&&g.get(`/api/alterion/panel/files/${D.id}/list/`,{params:{path:"/"},withCredentials:!0}).then(e=>{e.data.home_directory?(C(e.data.home_directory),E(e.data.home_directory),Ne([e.data.home_directory]),Se(0)):(C(null),E("/"),Ne(["/"]),Se(0))})},[D]),e.useEffect(()=>{D&&T&&ze()},[T]);const ze=async()=>{if(D){I(!0),L("");try{const e=await g.get(`/api/alterion/panel/files/${D.id}/list/`,{params:{path:T},withCredentials:!0});_(e.data.files||[])}catch(e){L(e.response?.data?.error||"Failed to fetch files"),_([])}finally{I(!1)}}},De=e=>{if("directory"===e.type){const t="/"===T?`/${e.name}`:`${T}/${e.name}`;E(t),W(null)}else Te(e)},Re=async e=>{if(D&&e)try{ye(!0),ve(0),we("preparing");const t="/"===T?`/${e.name}`:`${T}/${e.name}`,a=(await g.post(`/api/alterion/panel/files/${D.id}/prepare-download/`,{path:t},{withCredentials:!0})).data.task_id,n=async()=>{const e=await g.get(`/api/alterion/panel/files/${D.id}/download-progress/`,{params:{task_id:a},withCredentials:!0}),{status:t,progress:n,message:s}=e.data;if(ve(n),we("ready"===t?"downloading":"preparing"),"ready"===t)return!0;if("error"===t)throw new Error(s||"Failed to prepare download");return!1};for(;;){if(await n())break;await new Promise(e=>setTimeout(e,500))}we("downloading");const s=await g.get(`/api/alterion/panel/files/${D.id}/download/`,{params:{task_id:a},responseType:"blob",withCredentials:!0,onDownloadProgress:e=>{if(e.total){const t=Math.round(100*e.loaded/e.total);ve(t)}}});we("complete"),ve(100);let l=e.name;const i=s.headers["content-disposition"];if(i){const e=i.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);e&&e[1]&&(l=e[1].replace(/['"]/g,""))}const r=window.URL.createObjectURL(new Blob([s.data])),o=document.createElement("a");o.href=r,o.setAttribute("download",l),document.body.appendChild(o),o.click(),o.remove(),window.URL.revokeObjectURL(r),setTimeout(()=>{ye(!1),ve(0),we("")},1e3)}catch(t){ye(!1),L(t.response?.data?.error||t.message||"Failed to download file")}},Be=async()=>{if(!D||!xe)return;I(!0),L("");const e="/"===T?`/${xe.name}`:`${T}/${xe.name}`;try{await g.delete(`/api/alterion/panel/files/${D.id}/delete/`,{params:{path:e},withCredentials:!0}),W(null),pe(!1),ue(null),fe(""),ze()}catch(t){L(t.response?.data?.error||"Failed to delete")}finally{I(!1)}},Te=async e=>{if(D&&e){I(!0),L("");try{const t="/"===T?`/${e.name}`:`${T}/${e.name}`,a=await g.get(`/api/alterion/panel/files/${D.id}/read_file/`,{params:{path:t},withCredentials:!0});X(a.data.content||""),ee(e)}catch(t){L(t.response?.data?.error||"Failed to read file")}finally{I(!1)}}},Ee=e=>{if(!e||0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB"][t]};return t.jsxs("div",{className:"file-manager",style:{color:N},children:[y&&t.jsx("div",{style:{background:"#222",color:"#fff",padding:"8px",marginBottom:"8px",borderRadius:"6px",fontSize:"13px"},children:y}),t.jsx("div",{className:"server-selector",style:{color:N},children:t.jsx(f,{selectedNode:D,onNodeChange:e=>{R(e),E("/")},onServerContextMenu:(e,t)=>k(e,t,{onEdit:e=>{},onDelete:async e=>{if(confirm(`Are you sure you want to delete server "${e.name}"?`))try{await g.delete(`/api/alterion/panel/nodes/${e.id}/`,{withCredentials:!0}),D?.id===e.id&&R(null)}catch(t){}}})})}),t.jsxs("div",{className:"actions-bar",style:{margin:"1.2rem 0"},children:[t.jsx("div",{className:"search-filter",style:{flex:1},children:t.jsxs("div",{className:"search-box",style:{minWidth:200,flex:1,border:"1px solid rgba(255,255,255,0.1)",borderRadius:10,padding:"10px 16px",display:"flex",alignItems:"center",background:"transparent"},children:[t.jsx("button",{className:"btn-icon",style:{background:"none",border:"none",boxShadow:"none",marginRight:4,padding:0,display:"flex",alignItems:"center"},onClick:()=>{$e>0&&(Se($e-1),E(ke[$e-1]))},disabled:0===$e,title:"Back",type:"button",children:t.jsx(a,{size:18,color:N})}),t.jsx("button",{className:"btn-icon",style:{background:"none",border:"none",boxShadow:"none",marginRight:8,padding:0,display:"flex",alignItems:"center"},onClick:()=>{$e<ke.length-1&&(Se($e+1),E(ke[$e+1]))},disabled:$e===ke.length-1,title:"Forward",type:"button",children:t.jsx(n,{size:18,color:N})}),t.jsx("button",{className:"btn-icon",style:{background:"none",border:"none",boxShadow:"none",marginRight:8,padding:0,display:"flex",alignItems:"center"},onClick:()=>{if(!T||"/"===T)return;let e=T.replace(/\\/g,"/");e.length>1&&e.endsWith("/")&&(e=e.slice(0,-1)),e=e.replace(/^C:\//,"/").replace(/^C:/,"");const t=e.split("/").filter(Boolean);0===t.length?e="/":(e="/"+t.slice(0,-1).join("/"),""===e&&(e="/")),E(e)},disabled:"/"===T,title:"Up One Folder",type:"button",children:t.jsx(s,{size:18,color:N})}),t.jsx(l,{size:18,style:{marginRight:8,opacity:.6,color:N}}),t.jsx("input",{type:"text",value:(Ue=T,Ue&&Ue.startsWith("C:")?Ue.replace(/^C:/,""):Ue),onChange:e=>E(e.target.value),onBlur:()=>ze(),onKeyDown:e=>{"Enter"===e.key&&ze()},style:{background:"transparent",border:"none",color:N,fontFamily:"monospace",fontSize:"1.08rem",outline:"none",width:"100%"},placeholder:"/path/to/folder"})]})}),t.jsxs("div",{className:"action-buttons",children:[t.jsxs("button",{className:"btn btn-secondary",onClick:()=>ae(!0),children:[t.jsx(i,{size:18})," Upload"]}),t.jsxs("button",{className:"btn btn-secondary",onClick:()=>se(!0),children:[t.jsx(r,{size:18})," New File"]}),t.jsxs("button",{className:"btn btn-secondary",onClick:()=>ie(!0),children:[t.jsx(o,{size:18})," New Folder"]})]})]}),M&&t.jsx("div",{className:"error-message",children:M}),D&&t.jsxs("div",{className:"file-manager-content",children:[te&&t.jsx("div",{className:"modal-overlay",onClick:()=>ae(!1),children:t.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[t.jsx("h3",{children:"Upload File"}),t.jsxs("div",{className:"upload-drop-area",style:{border:"2px dashed #888",borderRadius:"10px",padding:"18px 32px",background:"#222",color:"#eee",cursor:"pointer",minWidth:"180px",textAlign:"center",marginBottom:"1rem",transition:"border-color 0.2s"},onClick:()=>document.getElementById("modal-file-upload-input").click(),onDragOver:e=>{e.preventDefault(),e.currentTarget.style.borderColor="#4f8cff"},onDragLeave:e=>{e.preventDefault(),e.currentTarget.style.borderColor="#888"},onDrop:e=>{e.preventDefault(),e.currentTarget.style.borderColor="#888",e.dataTransfer.files&&e.dataTransfer.files.length>0&&K(e.dataTransfer.files[0])},children:[t.jsx(i,{size:24,style:{marginBottom:8,opacity:.8}}),t.jsx("div",{style:{fontWeight:600,fontSize:"15px"},children:"Drag & Drop or Click to Select File"}),t.jsx("input",{id:"modal-file-upload-input",type:"file",style:{display:"none"},onChange:e=>{e.target.files&&e.target.files.length>0&&K(e.target.files[0])}}),O&&t.jsxs("div",{style:{marginTop:"10px",fontSize:"13px",color:"#4f8cff"},children:["Selected: ",O.name]})]}),t.jsxs("div",{className:"modal-actions",children:[t.jsx("button",{onClick:async()=>{if(D&&O){I(!0),L("");try{const e=new FormData;e.append("file",O),e.append("path",T),await g.post(`/api/alterion/panel/files/${D.id}/upload/`,e,{headers:{"Content-Type":"multipart/form-data"},withCredentials:!0}),K(null),ze()}catch(e){L(e.response?.data?.error||"Failed to upload file")}finally{I(!1)}}},disabled:!O||P,children:"Upload"}),t.jsx("button",{onClick:()=>ae(!1),children:"Cancel"})]})]})}),ne&&t.jsx("div",{className:"modal-overlay",onClick:()=>se(!1),children:t.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[t.jsx("h3",{children:"Create New File"}),t.jsx("input",{type:"text",placeholder:"File name",value:re,onChange:e=>oe(e.target.value)}),t.jsxs("div",{className:"modal-actions",children:[t.jsx("button",{onClick:()=>{if(!D||!re.trim())return;I(!0),L("");const e="/"===T?`/${re}`:`${T}/${re}`;g.post(`/api/alterion/panel/files/${D.id}/write_file/`,{path:e,content:""},{withCredentials:!0}).then(()=>{se(!1),oe(""),ze()}).catch(e=>{L(e.response?.data?.error||"Failed to create file")}).finally(()=>{I(!1)})},disabled:!re.trim()||P,children:"Create"}),t.jsx("button",{onClick:()=>se(!1),children:"Cancel"})]})]})}),le&&t.jsx("div",{className:"modal-overlay",onClick:()=>ie(!1),children:t.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[t.jsx("h3",{children:"Create New Folder"}),t.jsx("input",{type:"text",placeholder:"Folder name",value:G,onChange:e=>H(e.target.value)}),t.jsxs("div",{className:"modal-actions",children:[t.jsx("button",{onClick:async()=>{if(D&&G.trim()){I(!0),L("");try{const e="/"===T?`/${G}`:`${T}/${G}`;await g.post(`/api/alterion/panel/files/${D.id}/create_directory/`,{path:e},{withCredentials:!0}),H(""),ze()}catch(e){L(e.response?.data?.error||"Failed to create folder")}finally{I(!1)}}},disabled:!G.trim()||P,children:"Create"}),t.jsx("button",{onClick:()=>ie(!1),children:"Cancel"})]})]})}),P?t.jsx("div",{className:"loading",children:"Loading..."}):t.jsxs("div",{className:"domains-table-container",style:{color:N,background:`linear-gradient(135deg, ${$}10, ${$}05)`,borderColor:S(N,.5)},children:[t.jsxs("table",{className:"domains-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:t.jsx("input",{type:"checkbox",checked:he,onChange:()=>{ce(he?[]:U.map(e=>e.name))}})}),t.jsx("th",{children:"Name"}),t.jsx("th",{children:"Type"}),t.jsx("th",{children:"Size"}),t.jsx("th",{children:"Modified"}),t.jsx("th",{children:"Permissions"}),t.jsx("th",{children:"Actions"})]})}),t.jsx("tbody",{children:U.map((e,a)=>{return t.jsxs("tr",{className:A?.name===e.name?"selected":"",onClick:()=>W(e),style:{borderTopColor:S(N,.5)},children:[t.jsx("td",{children:t.jsx("input",{type:"checkbox",checked:de.includes(e.name),onChange:t=>{return a=e.name,n=t.target.checked,void ce(e=>n?[...e,a]:e.filter(e=>e!==a));var a,n}})}),t.jsxs("td",{className:"file-name domain-cell",onDoubleClick:()=>De(e),children:[t.jsx("span",{className:`file-icon ${e.type}`,children:"directory"===e.type?t.jsx(l,{size:16}):t.jsx(r,{size:16})}),e.name]}),t.jsx("td",{children:e.type}),t.jsx("td",{children:"file"===e.type?Ee(e.size):"-"}),t.jsx("td",{children:(n=e.modified,n?new Date(n).toLocaleString():"-")}),t.jsx("td",{children:e.permissions||"-"}),t.jsxs("td",{className:"actions action-buttons-cell",children:["file"===e.type&&t.jsxs(t.Fragment,{children:[t.jsx("button",{className:"btn-icon",title:"Download",onClick:()=>Re(e),children:t.jsx(d,{size:16})}),t.jsx("button",{className:"btn-icon",title:"Edit",onClick:()=>Te(e),children:t.jsx(c,{size:16})})]}),"directory"===e.type&&t.jsx("button",{className:"btn-icon",title:"Download ZIP",onClick:()=>Re(e),children:t.jsx(d,{size:16})}),t.jsx("button",{className:"btn-icon",title:"Rename",onClick:()=>{W(e),Z(e.name),Q(!0)},children:t.jsx(h,{size:16})}),t.jsx("button",{className:"btn-icon btn-danger",title:"Delete",onClick:()=>(e=>{D&&e&&(ue(e),pe(!0),fe(""))})(e),children:t.jsx(m,{size:16})}),je&&t.jsx("div",{className:"modal-overlay",children:t.jsxs("div",{className:"modal-content",style:{maxWidth:400},children:[t.jsx("div",{className:"modal-header",children:t.jsxs("h2",{style:{display:"flex",alignItems:"center",gap:8},children:[t.jsx(d,{size:22,style:{color:"#10b981"}}),"preparing"===Ce?"Preparing Download":"downloading"===Ce?"Downloading":"Complete"]})}),t.jsxs("div",{style:{marginBottom:20},children:["preparing"===Ce&&t.jsx("div",{style:{textAlign:"center",marginBottom:16},children:t.jsx("div",{style:{fontSize:14,color:"var(--text-secondary)",marginBottom:12},children:"Creating archive..."})}),t.jsx("div",{style:{width:"100%",height:8,background:"rgba(255, 255, 255, 0.1)",borderRadius:4,overflow:"hidden"},children:t.jsx("div",{style:{width:`${be}%`,height:"100%",background:"complete"===Ce?"#10b981":"#ffffff",transition:"width 0.3s ease",borderRadius:4}})}),t.jsxs("div",{style:{textAlign:"center",marginTop:8,fontSize:14,fontWeight:500},children:[be,"%"]})]})]})}),me&&xe&&t.jsx("div",{className:"modal-overlay",onClick:()=>pe(!1),children:t.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[t.jsx("div",{className:"modal-header",children:t.jsxs("h2",{style:{display:"flex",alignItems:"center",gap:8},children:[t.jsx(m,{size:22,style:{color:"#ef4444"}}),"Delete File"]})}),t.jsxs("div",{style:{marginBottom:16},children:["Are you sure you want to delete ",t.jsx("strong",{children:xe.name}),"? This action cannot be undone.",t.jsx("br",{}),"Type ",t.jsx("strong",{children:xe.name})," to confirm."]}),t.jsx("input",{type:"text",value:ge,onChange:e=>fe(e.target.value),placeholder:`Type '${xe.name}' to confirm`,style:{width:"100%",marginBottom:16}}),t.jsxs("div",{className:"modal-actions",children:[t.jsx("button",{className:"btn btn-danger",onClick:Be,disabled:ge!==xe.name||P,children:"Delete"}),t.jsx("button",{className:"btn",onClick:()=>pe(!1),children:"Cancel"})]})]})})]})]},a);var n})})]}),0===U.length&&!P&&t.jsx("div",{className:"empty-state",children:"No files in this directory"})]})]}),J&&t.jsx("div",{className:"modal-overlay",onClick:()=>Q(!1),children:t.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[t.jsxs("h3",{children:["Rename ",A?.name]}),t.jsx("input",{type:"text",value:V,onChange:e=>Z(e.target.value),placeholder:"New name"}),t.jsxs("div",{className:"modal-actions",children:[t.jsx("button",{onClick:async()=>{if(D&&A&&V.trim()){I(!0),L("");try{const e="/"===T?`/${A.name}`:`${T}/${A.name}`,t="/"===T?`/${V}`:`${T}/${V}`;await g.post(`/api/alterion/panel/files/${D.id}/rename/`,{old_path:e,new_path:t},{withCredentials:!0}),Q(!1),Z(""),W(null),ze()}catch(e){L(e.response?.data?.error||"Failed to rename")}finally{I(!1)}}},disabled:!V.trim(),children:"Rename"}),t.jsx("button",{onClick:()=>Q(!1),children:"Cancel"})]})]})}),Y&&t.jsx("div",{className:"modal-overlay",onClick:()=>ee(null),children:t.jsxs("div",{className:"modal-content editor-modal",onClick:e=>e.stopPropagation(),children:[t.jsxs("h3",{children:["Editing: ",Y.name]}),t.jsx("textarea",{value:q,onChange:e=>X(e.target.value),rows:20}),t.jsxs("div",{className:"modal-actions",children:[t.jsx("button",{onClick:async()=>{if(D&&Y){I(!0),L("");try{const e="/"===T?`/${Y.name}`:`${T}/${Y.name}`;await g.post(`/api/alterion/panel/files/${D.id}/write_file/`,{path:e,content:q},{withCredentials:!0}),ee(null),X(""),ze()}catch(e){L(e.response?.data?.error||"Failed to save file")}finally{I(!1)}}},children:"Save"}),t.jsx("button",{onClick:()=>ee(null),children:"Cancel"})]})]})})]});var Ue};export{y as F};
