import{r as e,j as t,z as a,B as n,H as s,J as l,K as i,M as r,N as o,D as d,O as c,Q as h,v as m}from"./index1-DU0OaFhi.js";import{T as p,g as x,a as u,S as g}from"./index2-ErLKS2H5.js";var f={};const j=()=>{const[j,y]=e.useState(""),[b,v]=e.useState(null),{customSettings:C}=e.useContext(p),w=x(C,"background"),k=C?.backgroundColor1||"#1a1a1a",N=(e,t)=>{if(!e)return`rgba(255, 255, 255, ${t})`;return`rgba(${parseInt(e.slice(1,3),16)}, ${parseInt(e.slice(3,5),16)}, ${parseInt(e.slice(5,7),16)}, ${t})`},[$,S]=e.useState([]),[F,z]=e.useState(null),D=(()=>{const e=window?.alterionUser||window?.USER||f?.USER||f?.USERNAME||"",t=window?.alterionPlatform||window?.navigator?.platform||"";return t.toLowerCase().includes("win")||t.toLowerCase().includes("mac")?e?`/Users/${e}`:"/Users":e?`/home/${e}`:"/home"})(),[B,R]=e.useState(D),[T,E]=e.useState([]),[U,_]=e.useState(!1),[P,I]=e.useState(""),[L,M]=e.useState(null),[A,W]=e.useState(null),[O,K]=e.useState(""),[G,H]=e.useState(!1),[J,Q]=e.useState(""),[Z,q]=e.useState(""),[V,X]=e.useState(null),[Y,ee]=e.useState(!1),[te,ae]=e.useState(!1),[ne,se]=e.useState(!1),[le,ie]=e.useState(""),[re,oe]=e.useState([]),de=T.length>0&&re.length===T.length,[ce,he]=e.useState(!1),[me,pe]=e.useState(null),[xe,ue]=e.useState(""),[ge,fe]=e.useState(!1),[je,ye]=e.useState(0),[be,ve]=e.useState(""),[Ce,we]=e.useState([D]),[ke,Ne]=e.useState(0);e.useEffect(()=>{if(B!==Ce[ke]){const e=Ce.slice(0,ke+1);e.push(B),we(e),Ne(e.length-1)}},[B]);e.useEffect(()=>{$e()},[]);const $e=async()=>{try{const e=await u.get("/api/alterion/panel/server/available-servers",{withCredentials:!0});S(e.data.servers||[]),e.data.servers&&e.data.servers.length>0&&z(e.data.servers[0])}catch(e){I("Failed to fetch servers")}};e.useEffect(()=>{F&&u.get(`/api/alterion/panel/files/${F.id}/list/`,{params:{path:"/"},withCredentials:!0}).then(e=>{e.data.home_directory?(v(e.data.home_directory),R(e.data.home_directory),we([e.data.home_directory]),Ne(0)):(v(null),R("/"),we(["/"]),Ne(0))})},[F]),e.useEffect(()=>{F&&B&&Se()},[B]);const Se=async()=>{if(F){_(!0),I("");try{const e=await u.get(`/api/alterion/panel/files/${F.id}/list/`,{params:{path:B},withCredentials:!0});E(e.data.files||[])}catch(e){I(e.response?.data?.error||"Failed to fetch files"),E([])}finally{_(!1)}}},Fe=e=>{if("directory"===e.type){const t="/"===B?`/${e.name}`:`${B}/${e.name}`;R(t),M(null)}else Be(e)},ze=async e=>{if(F&&e)try{fe(!0),ye(0),ve("preparing");const t="/"===B?`/${e.name}`:`${B}/${e.name}`,a=(await u.post(`/api/alterion/panel/files/${F.id}/prepare-download/`,{path:t},{withCredentials:!0})).data.task_id,n=async()=>{const e=await u.get(`/api/alterion/panel/files/${F.id}/download-progress/`,{params:{task_id:a},withCredentials:!0}),{status:t,progress:n,message:s}=e.data;if(ye(n),ve("ready"===t?"downloading":"preparing"),"ready"===t)return!0;if("error"===t)throw new Error(s||"Failed to prepare download");return!1};for(;;){if(await n())break;await new Promise(e=>setTimeout(e,500))}ve("downloading");const s=await u.get(`/api/alterion/panel/files/${F.id}/download/`,{params:{task_id:a},responseType:"blob",withCredentials:!0,onDownloadProgress:e=>{if(e.total){const t=Math.round(100*e.loaded/e.total);ye(t)}}});ve("complete"),ye(100);let l=e.name;const i=s.headers["content-disposition"];if(i){const e=i.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);e&&e[1]&&(l=e[1].replace(/['"]/g,""))}const r=window.URL.createObjectURL(new Blob([s.data])),o=document.createElement("a");o.href=r,o.setAttribute("download",l),document.body.appendChild(o),o.click(),o.remove(),window.URL.revokeObjectURL(r),setTimeout(()=>{fe(!1),ye(0),ve("")},1e3)}catch(t){fe(!1),I(t.response?.data?.error||t.message||"Failed to download file")}},De=async()=>{if(!F||!me)return;_(!0),I("");const e="/"===B?`/${me.name}`:`${B}/${me.name}`;try{await u.delete(`/api/alterion/panel/files/${F.id}/delete/`,{params:{path:e},withCredentials:!0}),M(null),he(!1),pe(null),ue(""),Se()}catch(t){I(t.response?.data?.error||"Failed to delete")}finally{_(!1)}},Be=async e=>{if(F&&e){_(!0),I("");try{const t="/"===B?`/${e.name}`:`${B}/${e.name}`,a=await u.get(`/api/alterion/panel/files/${F.id}/read_file/`,{params:{path:t},withCredentials:!0});q(a.data.content||""),X(e)}catch(t){I(t.response?.data?.error||"Failed to read file")}finally{_(!1)}}},Re=e=>{if(!e||0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB"][t]};return t.jsxs("div",{className:"file-manager",style:{color:w},children:[j&&t.jsx("div",{style:{background:"#222",color:"#fff",padding:"8px",marginBottom:"8px",borderRadius:"6px",fontSize:"13px"},children:j}),t.jsx("div",{className:"server-selector",style:{color:w},children:t.jsx(g,{selectedNode:F,onNodeChange:e=>{z(e),R("/")}})}),t.jsxs("div",{className:"actions-bar",style:{margin:"1.2rem 0"},children:[t.jsx("div",{className:"search-filter",style:{flex:1},children:t.jsxs("div",{className:"search-box",style:{minWidth:200,flex:1,border:"1px solid rgba(255,255,255,0.1)",borderRadius:10,padding:"10px 16px",display:"flex",alignItems:"center",background:"transparent"},children:[t.jsx("button",{className:"btn-icon",style:{background:"none",border:"none",boxShadow:"none",marginRight:4,padding:0,display:"flex",alignItems:"center"},onClick:()=>{ke>0&&(Ne(ke-1),R(Ce[ke-1]))},disabled:0===ke,title:"Back",type:"button",children:t.jsx(a,{size:18,color:w})}),t.jsx("button",{className:"btn-icon",style:{background:"none",border:"none",boxShadow:"none",marginRight:8,padding:0,display:"flex",alignItems:"center"},onClick:()=>{ke<Ce.length-1&&(Ne(ke+1),R(Ce[ke+1]))},disabled:ke===Ce.length-1,title:"Forward",type:"button",children:t.jsx(n,{size:18,color:w})}),t.jsx("button",{className:"btn-icon",style:{background:"none",border:"none",boxShadow:"none",marginRight:8,padding:0,display:"flex",alignItems:"center"},onClick:()=>{if(!B||"/"===B)return;let e=B.replace(/\\/g,"/");e.length>1&&e.endsWith("/")&&(e=e.slice(0,-1)),e=e.replace(/^C:\//,"/").replace(/^C:/,"");const t=e.split("/").filter(Boolean);0===t.length?e="/":(e="/"+t.slice(0,-1).join("/"),""===e&&(e="/")),R(e)},disabled:"/"===B,title:"Up One Folder",type:"button",children:t.jsx(s,{size:18,color:w})}),t.jsx(l,{size:18,style:{marginRight:8,opacity:.6,color:w}}),t.jsx("input",{type:"text",value:(Te=B,Te&&Te.startsWith("C:")?Te.replace(/^C:/,""):Te),onChange:e=>R(e.target.value),onBlur:()=>Se(),onKeyDown:e=>{"Enter"===e.key&&Se()},style:{background:"transparent",border:"none",color:w,fontFamily:"monospace",fontSize:"1.08rem",outline:"none",width:"100%"},placeholder:"/path/to/folder"})]})}),t.jsxs("div",{className:"action-buttons",children:[t.jsxs("button",{className:"btn btn-secondary",onClick:()=>ee(!0),children:[t.jsx(i,{size:18})," Upload"]}),t.jsxs("button",{className:"btn btn-secondary",onClick:()=>ae(!0),children:[t.jsx(r,{size:18})," New File"]}),t.jsxs("button",{className:"btn btn-secondary",onClick:()=>se(!0),children:[t.jsx(o,{size:18})," New Folder"]})]})]}),P&&t.jsx("div",{className:"error-message",children:P}),F&&t.jsxs("div",{className:"file-manager-content",children:[Y&&t.jsx("div",{className:"modal-overlay",onClick:()=>ee(!1),children:t.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[t.jsx("h3",{children:"Upload File"}),t.jsxs("div",{className:"upload-drop-area",style:{border:"2px dashed #888",borderRadius:"10px",padding:"18px 32px",background:"#222",color:"#eee",cursor:"pointer",minWidth:"180px",textAlign:"center",marginBottom:"1rem",transition:"border-color 0.2s"},onClick:()=>document.getElementById("modal-file-upload-input").click(),onDragOver:e=>{e.preventDefault(),e.currentTarget.style.borderColor="#4f8cff"},onDragLeave:e=>{e.preventDefault(),e.currentTarget.style.borderColor="#888"},onDrop:e=>{e.preventDefault(),e.currentTarget.style.borderColor="#888",e.dataTransfer.files&&e.dataTransfer.files.length>0&&W(e.dataTransfer.files[0])},children:[t.jsx(i,{size:24,style:{marginBottom:8,opacity:.8}}),t.jsx("div",{style:{fontWeight:600,fontSize:"15px"},children:"Drag & Drop or Click to Select File"}),t.jsx("input",{id:"modal-file-upload-input",type:"file",style:{display:"none"},onChange:e=>{e.target.files&&e.target.files.length>0&&W(e.target.files[0])}}),A&&t.jsxs("div",{style:{marginTop:"10px",fontSize:"13px",color:"#4f8cff"},children:["Selected: ",A.name]})]}),t.jsxs("div",{className:"modal-actions",children:[t.jsx("button",{onClick:async()=>{if(F&&A){_(!0),I("");try{const e=new FormData;e.append("file",A),e.append("path",B),await u.post(`/api/alterion/panel/files/${F.id}/upload/`,e,{headers:{"Content-Type":"multipart/form-data"},withCredentials:!0}),W(null),Se()}catch(e){I(e.response?.data?.error||"Failed to upload file")}finally{_(!1)}}},disabled:!A||U,children:"Upload"}),t.jsx("button",{onClick:()=>ee(!1),children:"Cancel"})]})]})}),te&&t.jsx("div",{className:"modal-overlay",onClick:()=>ae(!1),children:t.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[t.jsx("h3",{children:"Create New File"}),t.jsx("input",{type:"text",placeholder:"File name",value:le,onChange:e=>ie(e.target.value)}),t.jsxs("div",{className:"modal-actions",children:[t.jsx("button",{onClick:()=>{if(!F||!le.trim())return;_(!0),I("");const e="/"===B?`/${le}`:`${B}/${le}`;u.post(`/api/alterion/panel/files/${F.id}/write_file/`,{path:e,content:""},{withCredentials:!0}).then(()=>{ae(!1),ie(""),Se()}).catch(e=>{I(e.response?.data?.error||"Failed to create file")}).finally(()=>{_(!1)})},disabled:!le.trim()||U,children:"Create"}),t.jsx("button",{onClick:()=>ae(!1),children:"Cancel"})]})]})}),ne&&t.jsx("div",{className:"modal-overlay",onClick:()=>se(!1),children:t.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[t.jsx("h3",{children:"Create New Folder"}),t.jsx("input",{type:"text",placeholder:"Folder name",value:O,onChange:e=>K(e.target.value)}),t.jsxs("div",{className:"modal-actions",children:[t.jsx("button",{onClick:async()=>{if(F&&O.trim()){_(!0),I("");try{const e="/"===B?`/${O}`:`${B}/${O}`;await u.post(`/api/alterion/panel/files/${F.id}/create_directory/`,{path:e},{withCredentials:!0}),K(""),Se()}catch(e){I(e.response?.data?.error||"Failed to create folder")}finally{_(!1)}}},disabled:!O.trim()||U,children:"Create"}),t.jsx("button",{onClick:()=>se(!1),children:"Cancel"})]})]})}),U?t.jsx("div",{className:"loading",children:"Loading..."}):t.jsxs("div",{className:"domains-table-container",style:{color:w,background:`linear-gradient(135deg, ${k}10, ${k}05)`,borderColor:N(w,.5)},children:[t.jsxs("table",{className:"domains-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:t.jsx("input",{type:"checkbox",checked:de,onChange:()=>{oe(de?[]:T.map(e=>e.name))}})}),t.jsx("th",{children:"Name"}),t.jsx("th",{children:"Type"}),t.jsx("th",{children:"Size"}),t.jsx("th",{children:"Modified"}),t.jsx("th",{children:"Permissions"}),t.jsx("th",{children:"Actions"})]})}),t.jsx("tbody",{children:T.map((e,a)=>{return t.jsxs("tr",{className:L?.name===e.name?"selected":"",onClick:()=>M(e),style:{borderTopColor:N(w,.5)},children:[t.jsx("td",{children:t.jsx("input",{type:"checkbox",checked:re.includes(e.name),onChange:t=>{return a=e.name,n=t.target.checked,void oe(e=>n?[...e,a]:e.filter(e=>e!==a));var a,n}})}),t.jsxs("td",{className:"file-name domain-cell",onDoubleClick:()=>Fe(e),children:[t.jsx("span",{className:`file-icon ${e.type}`,children:"directory"===e.type?t.jsx(l,{size:16}):t.jsx(r,{size:16})}),e.name]}),t.jsx("td",{children:e.type}),t.jsx("td",{children:"file"===e.type?Re(e.size):"-"}),t.jsx("td",{children:(n=e.modified,n?new Date(n).toLocaleString():"-")}),t.jsx("td",{children:e.permissions||"-"}),t.jsxs("td",{className:"actions action-buttons-cell",children:["file"===e.type&&t.jsxs(t.Fragment,{children:[t.jsx("button",{className:"btn-icon",title:"Download",onClick:()=>ze(e),children:t.jsx(d,{size:16})}),t.jsx("button",{className:"btn-icon",title:"Edit",onClick:()=>Be(e),children:t.jsx(c,{size:16})})]}),"directory"===e.type&&t.jsx("button",{className:"btn-icon",title:"Download ZIP",onClick:()=>ze(e),children:t.jsx(d,{size:16})}),t.jsx("button",{className:"btn-icon",title:"Rename",onClick:()=>{M(e),Q(e.name),H(!0)},children:t.jsx(h,{size:16})}),t.jsx("button",{className:"btn-icon btn-danger",title:"Delete",onClick:()=>(e=>{F&&e&&(pe(e),he(!0),ue(""))})(e),children:t.jsx(m,{size:16})}),ge&&t.jsx("div",{className:"modal-overlay",children:t.jsxs("div",{className:"modal-content",style:{maxWidth:400},children:[t.jsx("div",{className:"modal-header",children:t.jsxs("h2",{style:{display:"flex",alignItems:"center",gap:8},children:[t.jsx(d,{size:22,style:{color:"#10b981"}}),"preparing"===be?"Preparing Download":"downloading"===be?"Downloading":"Complete"]})}),t.jsxs("div",{style:{marginBottom:20},children:["preparing"===be&&t.jsx("div",{style:{textAlign:"center",marginBottom:16},children:t.jsx("div",{style:{fontSize:14,color:"var(--text-secondary)",marginBottom:12},children:"Creating archive..."})}),t.jsx("div",{style:{width:"100%",height:8,background:"rgba(255, 255, 255, 0.1)",borderRadius:4,overflow:"hidden"},children:t.jsx("div",{style:{width:`${je}%`,height:"100%",background:"complete"===be?"#10b981":"#ffffff",transition:"width 0.3s ease",borderRadius:4}})}),t.jsxs("div",{style:{textAlign:"center",marginTop:8,fontSize:14,fontWeight:500},children:[je,"%"]})]})]})}),ce&&me&&t.jsx("div",{className:"modal-overlay",onClick:()=>he(!1),children:t.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[t.jsx("div",{className:"modal-header",children:t.jsxs("h2",{style:{display:"flex",alignItems:"center",gap:8},children:[t.jsx(m,{size:22,style:{color:"#ef4444"}}),"Delete File"]})}),t.jsxs("div",{style:{marginBottom:16},children:["Are you sure you want to delete ",t.jsx("strong",{children:me.name}),"? This action cannot be undone.",t.jsx("br",{}),"Type ",t.jsx("strong",{children:me.name})," to confirm."]}),t.jsx("input",{type:"text",value:xe,onChange:e=>ue(e.target.value),placeholder:`Type '${me.name}' to confirm`,style:{width:"100%",marginBottom:16}}),t.jsxs("div",{className:"modal-actions",children:[t.jsx("button",{className:"btn btn-danger",onClick:De,disabled:xe!==me.name||U,children:"Delete"}),t.jsx("button",{className:"btn",onClick:()=>he(!1),children:"Cancel"})]})]})})]})]},a);var n})})]}),0===T.length&&!U&&t.jsx("div",{className:"empty-state",children:"No files in this directory"})]})]}),G&&t.jsx("div",{className:"modal-overlay",onClick:()=>H(!1),children:t.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[t.jsxs("h3",{children:["Rename ",L?.name]}),t.jsx("input",{type:"text",value:J,onChange:e=>Q(e.target.value),placeholder:"New name"}),t.jsxs("div",{className:"modal-actions",children:[t.jsx("button",{onClick:async()=>{if(F&&L&&J.trim()){_(!0),I("");try{const e="/"===B?`/${L.name}`:`${B}/${L.name}`,t="/"===B?`/${J}`:`${B}/${J}`;await u.post(`/api/alterion/panel/files/${F.id}/rename/`,{old_path:e,new_path:t},{withCredentials:!0}),H(!1),Q(""),M(null),Se()}catch(e){I(e.response?.data?.error||"Failed to rename")}finally{_(!1)}}},disabled:!J.trim(),children:"Rename"}),t.jsx("button",{onClick:()=>H(!1),children:"Cancel"})]})]})}),V&&t.jsx("div",{className:"modal-overlay",onClick:()=>X(null),children:t.jsxs("div",{className:"modal-content editor-modal",onClick:e=>e.stopPropagation(),children:[t.jsxs("h3",{children:["Editing: ",V.name]}),t.jsx("textarea",{value:Z,onChange:e=>q(e.target.value),rows:20}),t.jsxs("div",{className:"modal-actions",children:[t.jsx("button",{onClick:async()=>{if(F&&V){_(!0),I("");try{const e="/"===B?`/${V.name}`:`${B}/${V.name}`;await u.post(`/api/alterion/panel/files/${F.id}/write_file/`,{path:e,content:Z},{withCredentials:!0}),X(null),q(""),Se()}catch(e){I(e.response?.data?.error||"Failed to save file")}finally{_(!1)}}},children:"Save"}),t.jsx("button",{onClick:()=>X(null),children:"Cancel"})]})]})})]});var Te};export{j as F};
